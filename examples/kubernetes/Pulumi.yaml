name: pulumi-provider-grid
runtime: yaml

plugins:
  providers:
    - name: grid
      path: ../..

resources:
  provider:
    type: pulumi:providers:grid
    properties:
      mnemonic:

  network:
    type: grid:internal:Network
    options:
      provider: ${provider}
    properties:
      name: test
      description: test network
      nodes:
        - 29
      ip_range: 10.1.0.0/16

  kubernetes:
    type: grid:internal:Kubernetes
    options:
      provider: ${provider}
      dependsOn:
        - ${network}
    properties:
      master:
        name: kubernetes
        node: 29
        disk_size: 2
        planetary: true
        public_ip: true
        cpu: 2
        memory: 2048

      workers:
        - name: worker1
          node: 29
          disk_size: 2
          cpu: 2
          memory: 2048
        - name: worker2
          node: 29
          disk_size: 2
          cpu: 2
          memory: 2048

      token: t123456789
      network_name: test

outputs:
  node_deployment_id: ${kubernetes.node_deployment_id}
  public_ip: ${kubernetes.master_computed.computed_ip}
  ygg_ip: ${kubernetes.master_computed.ygg_ip}
